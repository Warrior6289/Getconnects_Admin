{% extends 'base.html' %}
{% block title %}Edit Notification Template - GetConnects Portal{% endblock %}
{% block content %}
<h1 class="mb-3">Edit Notification Template</h1>
{% if not email_text_supported %}
<div class="alert alert-warning">
  Database migrations are required before notification templates can be modified. Please run the latest migrations to enable editing.
</div>
{% endif %}
<div class="mb-3 text-muted">
  <p class="mb-1">Lead placeholders:</p>
  {% for p in lead_placeholders %}
    <code>{{ '{' }}{{ p }}{{ '}' }}</code>{% if not loop.last %}, {% endif %}
  {% endfor %}
</div>
<div class="mb-3 text-muted">
  <p class="mb-1">Client placeholders:</p>
  {% for p in client_placeholders %}
    <code>{{ '{' }}{{ p }}{{ '}' }}</code>{% if not loop.last %}, {% endif %}
  {% endfor %}
</div>
<form method="post">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <div class="mb-3">
    <label class="form-label">Name</label>
    <input class="form-control" type="text" name="name" value="{{ tmpl.name }}">
  </div>
  <div class="mb-3">
    <label class="form-label">Channel</label>
    <select class="form-select" name="channel">
      <option value="both" {% if channel == 'both' %}selected{% endif %}>Both</option>
      <option value="sms" {% if channel == 'sms' %}selected{% endif %}>SMS</option>
      <option value="email" {% if channel == 'email' %}selected{% endif %}>Email</option>
    </select>
  </div>
  <div id="sms_fields" class="mb-3">
    <label class="form-label">SMS Template</label>
    <textarea class="form-control" name="sms_template">{{ tmpl.sms_template }}</textarea>
  </div>
  <div id="email_fields">
    <div class="mb-3">
      <label class="form-label">Email Subject</label>
      <input class="form-control" type="text" name="email_subject" value="{{ tmpl.email_subject }}">
    </div>
    <div class="mb-3">
      <label class="form-label">Email Text</label>
      <textarea class="form-control" name="email_text" {% if not email_text_supported %}disabled{% endif %}>{{ tmpl.email_text }}</textarea>
    </div>
    <div class="mb-3">
      <label class="form-label">Email HTML</label>
      <textarea class="form-control" name="email_html">{{ tmpl.email_html }}</textarea>
    </div>
  </div>
  <div class="form-check mb-3">
    <input class="form-check-input" type="checkbox" name="is_default" id="is_default" {% if tmpl.is_default %}checked{% endif %}>
    <label class="form-check-label" for="is_default">Default</label>
  </div>
  <button class="btn btn-primary" {% if not email_text_supported %}disabled{% endif %}>Save</button>
  <a href="{{ url_for('settings.notification_templates') }}" class="btn btn-secondary ms-2">Cancel</a>
</form>
<script>
function toggleChannelFields() {
  const channel = document.querySelector('select[name="channel"]').value;
  document.getElementById('sms_fields').style.display = (channel === 'email') ? 'none' : 'block';
  document.getElementById('email_fields').style.display = (channel === 'sms') ? 'none' : 'block';
}
document.addEventListener('DOMContentLoaded', function() {
  const sel = document.querySelector('select[name="channel"]');
  sel.addEventListener('change', toggleChannelFields);
  toggleChannelFields();
});
</script>
{% endblock %}
